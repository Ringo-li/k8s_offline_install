! Configuration File for keepalived
global_defs {
    router_id lb-master
}

vrrp_script check-haproxy {
    script "killall -0 haproxy"
    interval 5
    weight -60
}

vrrp_instance VI-kube-master {
    state MASTER
    priority 120
    unicast_src_ip {{ groups['kube_node'][0] }}
    unicast_peer {
        {{ groups['kube_node'][1] }}
    }
    dont_track_primary
    interface eth1
    virtual_router_id 111
    advert_int 3
    track_script {
        check-haproxy
    }
    virtual_ipaddress {
        {{ VIP }}
    }
}
